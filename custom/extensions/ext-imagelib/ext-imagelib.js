const e="loading",t="https://alotool.github.io",n="library_add_img_url",i={png:{mimeType:"image/png",base64MimeType:"data:image/png;base64,"},jpg:{mimeType:"image/jpeg",base64MimeType:"data:image/jpeg;base64,"},jpe:{mimeType:"image/jpeg",base64MimeType:"data:image/jpeg;base64,"},jpeg:{mimeType:"image/jpeg",base64MimeType:"data:image/jpeg;base64,"},gif:{mimeType:"image/gif",base64MimeType:"data:image/gif;base64,"},bmp:{mimeType:"image/bmp",base64MimeType:"data:image/bmp;base64,"},webp:{mimeType:"image/webp",base64MimeType:"data:image/webp;base64,"},svg:{mimeType:"image/svg+xml",base64MimeType:"data:image/svg+xml;base64,"},ico:{mimeType:"image/vnd.microsoft.icon",base64MimeType:"data:image/vnd.microsoft.icon;base64,"}},$id=function(e){return document.getElementById(e)},imageToBase64=function(e){return new Promise((function(t,n){let o=document.createElement("canvas");const r=o.getContext("2d"),a=new Image;a.crossOrigin="Anonymous",a.onload=function(){o.height=a.height,o.width=a.width,r.drawImage(a,0,0);try{const n=i[getURLExtension(e)]?i[getURLExtension(e)].mimeType:"image/png",r=o.toDataURL(n);t(r)}catch(e){n(e)}finally{o=null}},a.src=e}))},getSVGFromURL=function(e){return new Promise((function(t,n){fetch(e).then((e=>e.text())).then((e=>(t(e),e))).catch((e=>{n(e)}))}))},getURLExtension=function(e){return e.split(/[#?]/)[0].split(".").pop().trim().toLowerCase()},showLoading=function(){const t=$id(e);t&&t.classList.add("typing-loader")},hideLoading=function(){const t=$id(e);t&&t.classList.remove("typing-loader")};const o=document.createElement("template");o.innerHTML="\n<style>\n  #btn_back,\n  #btn_cancel {\n    width: 30px;\n    height: 30px;\n    padding: 0;\n    margin: 0;\n    border: 0;\n    background-color: transparent;\n  }\n  #btn_back:hover,\n  #btn_cancel:hover {\n    cursor: pointer;\n    background-color: var(--icon-bg-color-hover);\n  }\n  #btn_cancel {\n    margin-left: auto;\n    color: var(--text-color-dark);\n  }\n  #btn_back img,\n  #btn_cancel img {\n    margin: auto;\n  }\n  #btn_submit {\n    position: absolute;\n    bottom: 10px;\n    right: 10px;\n    width: 230px;\n    height: 30px;\n    padding: 0;\n    color: var(--text-color-dark);\n    background-color: var(--main-color);\n    border: 1px solid var(--main-color);\n    border-radius: 0;\n  }\n  #btn_submit:hover {\n    border-color: var(--main-color-hover);\n    background-color: var(--main-color-hover);\n  }\n  #select_mode {\n    height: 28px;\n    background-color: var(--input-color);\n    color: var(--text-color);\n  }\n  #imglib_dialog {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background-color: rgba(0, 0, 0, .5);\n    z-index: 5\n  }\n  #imglib_container {\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    min-width: 100%;\n    min-height: 100%;\n    background: var(--main-bg-color);\n    border: 1px outset var(--border-color)\n  }\n  #imglib_head {\n    height: 35px;\n    display: flex;\n    align-items: center;\n    justify-content: flex-start;\n    margin: 0 10px;\n  }\n  #imglib_iframe,\n  #imglib_options {\n    position: absolute;\n    top: 35px;\n    bottom: 10px;\n    background: #fff;\n    margin: 0;\n    padding: 0\n  }\n  #imglib_iframe {\n    left: 0;\n    right: 0;\n  }\n  #imglib_iframe iframe {\n    width: 100%;\n    height: 100%;\n    border: 0\n  }\n  #imglib_options {\n    left: 10px;\n    right: 10px;\n    overflow: auto;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    background-color: var(--input-color);\n  }\n  #imglib_options li {\n    width: 200px;\n    height: 200px;\n    color: var(--input-text-color);\n    font-size: 14px;\n    list-style: none;\n    margin: 10px;\n    padding: 20px;\n    border: 1px solid var(--border-color);\n    border-radius: 10px;\n    background-color: var(--main-bg-color);\n    line-height: 1.2em;\n  }\n  #imglib_options li:hover {\n    cursor: pointer;\n    filter: brightness(115%);\n    color: var(--main-color);\n    background-color: var(--icon-bg-color-hover);\n  }\n  #imglib_options li > img {\n    width: 120px;\n    height: 120px;\n    margin-top: 10px;\n    margin-left: 10%;\n  }\n  #imglib_options li > span.name {\n    display: block;\n    margin-top: 10px;\n    margin-left: 10%;\n    font-size: 14px;\n  }\n  #imglib_options li > span.description {\n    display: block;\n    margin-top: 2px;\n    margin-left: 10%;\n    font-size: 10px;\n    color: var(--input-text-color) !important;\n  }\n  #imglib_preview {\n    position: absolute;\n    top: 35px;\n    right: 10px;\n    width: 230px;\n    bottom: 40px;\n    color: var(--input-text-color);\n    background: var(--input-color);\n    overflow: auto;\n    border: var(--input-border)\n  }\n  #imglib_preview > div {\n    padding: 5px;\n    display: flex;\n    justify-content: flex-start;\n    align-items: center;\n    font-size: 12px;\n    border-bottom: var(--input-border);\n  }\n  #imglib_preview > div:hover {\n    cursor: pointer;\n    background-color: var(--main-bg-color);\n  }\n  #imglib_preview img {\n    display: block;\n    width: 40px;\n    height: 40px;\n    background-color: #fafafa;\n  }\n  #imglib_preview span {\n    margin-left: 5px;\n    font-size: 12px;\n  }\n  #imglib_preview button {\n    width: 24px;\n    height: 24px;\n    padding: 0;\n    margin: 0 0 0 auto;\n    border: 0;\n    background-color: transparent;\n  }\n  #imglib_preview button:hover {\n    background-color: var(--icon-bg-color-hover);\n  }\n  #imglib_preview button img {\n    width: 12px;\n    height: 12px;\n    margin: auto;\n    background-color: transparent;\n  }\n  #imglib_preview button img:hover {\n    color: var(--main-color);\n  }\n</style>\n";const r="imagelib",a=["svg","png","jpg","jpe","jpeg","gif","ico","bmp","webp"],loadExtensionTranslation=async function(e){let t;const n=e.configObj.pref("lang");try{t=await function __variableDynamicImportRuntime0__(e){switch(e){case"./locale/de.js":return Promise.resolve().then((function(){return l}));case"./locale/en.js":return Promise.resolve().then((function(){return c}));case"./locale/fr.js":return Promise.resolve().then((function(){return m}));case"./locale/pl.js":return Promise.resolve().then((function(){return p}));case"./locale/pt-BR.js":return Promise.resolve().then((function(){return d}));case"./locale/ro.js":return Promise.resolve().then((function(){return b}));case"./locale/sk.js":return Promise.resolve().then((function(){return g}));case"./locale/sl.js":return Promise.resolve().then((function(){return u}));case"./locale/zh-CN.js":return Promise.resolve().then((function(){return _}));default:return new Promise((function(t,n){("function"==typeof queueMicrotask?queueMicrotask:setTimeout)(n.bind(null,new Error("Unknown variable dynamic import: "+e)))}))}}("./locale/".concat(n,".js"))}catch(e){console.warn("Missing translation (".concat(n,") for ").concat(r," - using 'en'")),t=await Promise.resolve().then((function(){return c}))}e.i18next.addResourceBundle(n,r,t.default)};var s={name:r,async init(e){const i=this,{$id:s}=i.svgCanvas,{$svgEditor:l}=i;await loadExtensionTranslation(i);const{svgCanvas:c}=i,{imgPath:m}=i.configObj.curConfig,p=[{url:"custom/extensions/ext-imagelib/library.html",name:i.i18next.t("".concat(r,":imgLibs_0_name")),icon:"images/logo.svg",description:i.i18next.t("".concat(r,":imgLibs_0_description"))},{url:"custom/extensions/ext-imagelib/pixabay-library.html",name:i.i18next.t("".concat(r,":imgLibs_1_name")),icon:"images/pixabay-logo.svg",description:i.i18next.t("".concat(r,":imgLibs_1_description"))}],closeBrowser=()=>{s("imglib_dialog").style.display="none",document.activeElement.blur()},importImage=e=>{const t=c.addSVGElementFromJson({element:"image",attr:{x:0,y:0,width:0,height:0,id:c.getNextId(),style:"pointer-events:inherit"}});c.clearSelection(),c.addToSelection([t]),c.setImageURL(e)};let d,b,g="s";const insertAfter=(e,t)=>{e.parentNode.insertBefore(t,e.nextSibling)},toggleMultiLoop=()=>{const e=[],t=document.querySelectorAll(".preview-item > img");t&&t.forEach(((t,n)=>{const o=t.getAttribute("data-id"),r=t.getAttribute("data-src"),a=t.getAttribute("data-ext");e.push(function importData(e,t,n,o){return new Promise((function(r,a){"svg"===n?getSVGFromURL(t).then((function(t){i.svgCanvas.importSvgString(t),r(e)}),(function(e){a(e)})):imageToBase64(t).then((function(t){importImage(t),r(e)}),(function(e){a(e)})),c.moveSelectedElements(20*o,20*o,!1)}))}(o,r,a,n))})),e&&e.length>0&&showLoading(),Promise.all(e).then((function(e){for(;d.firstChild;)d.removeChild(d.firstChild);b.setAttribute("disabled","true"),closeBrowser(),hideLoading()}),(function(e){hideLoading(),console.error(e)})).catch((e=>{hideLoading(),console.error(e)}))},toggleMulti=e=>{s("imglib_iframe").style.right=e?"250px":"10px",s("imglib_options").style.right=e?"250px":"10px",d||(d=document.createElement("div"),d.setAttribute("id","imglib_preview"),insertAfter(s("imglib_iframe"),d),b=document.createElement("button"),b.setAttribute("id","btn_submit"),b.setAttribute("disabled","true"),b.textContent="Import selected",s("imglib_container").appendChild(b),b.addEventListener("click",toggleMultiLoop),b.addEventListener("touchend",toggleMultiLoop)),b.style.display=e?"block":"none",d.style.display=e?"block":"none"},showBrowser=()=>{let e=s("imglib_container");if(e)s("imglib_dialog").style.display="block";else{const t=document.createElement("div");t.id="imglib_dialog",t.innerHTML='<div id="imglib_container"></div>',insertAfter(l,t),e=s("imglib_container");const n=document.createElement("ul");n.id="imglib_options",e.append(n);const o=document.createElement("div");o.id="imglib_iframe";const a=document.createElement("iframe");a.src="javascript:0",a.style.display="none",o.style.display="none",o.append(a),e.prepend(o);const c=document.createElement("div");c.setAttribute("id","imglib_head"),e.appendChild(c);const d=document.createElement("button");d.style.visibility="hidden";const b=i.i18next.t("".concat(r,":show_list"));d.innerHTML='<img class="svg_icon" src="'.concat(m,'/arrow-back-outline.svg" width="20" height="20" alt="').concat(b,'" title="').concat(b,'"/>'),d.addEventListener("click",(function(){a.setAttribute("src","about:blank"),a.style.display="none",o.style.display="none",n.style.display="flex",d.style.display="none"})),d.addEventListener("touchend",(function(){a.setAttribute("src","about:blank"),a.style.display="none",o.style.display="none",n.style.display="flex",d.style.display="none"})),d.setAttribute("id","btn_back"),d.setAttribute("style","margin-right: 5px;"),d.style.display="none",c.appendChild(d);const u=document.createElement("select");u.setAttribute("id","select_mode"),u.innerHTML="\n          <select>\n            <option value=s>".concat(i.i18next.t("".concat(r,":import_single")),"</option>\n            <option value=m>").concat(i.i18next.t("".concat(r,":import_multi")),"</option>\n            <option value=o>").concat(i.i18next.t("".concat(r,":open")),"</option>\n          </select>"),u.addEventListener("change",(function(){switch(g=this.value,g){case"s":case"o":toggleMulti(!1);break;case"m":toggleMulti(!0)}})),c.appendChild(u);const _=document.createElement("button");_.setAttribute("id","btn_cancel");const y=i.i18next.t("common.cancel");_.innerHTML='<img class="svg_icon" src="'.concat(m,'/cancel_close.svg" width="20" height="20" alt="').concat(y,'" title="').concat(y,'"/>'),_.addEventListener("click",(function(){s("imglib_dialog").style.display="none"})),_.addEventListener("touchend",(function(){s("imglib_dialog").style.display="none"})),c.appendChild(_),p.forEach((function(e){let{url:t,name:i,icon:r,description:s}=e;const l=document.createElement("li"),c=document.createElement("img");c.src=r;const m=document.createElement("span");m.classList.add("name"),m.textContent=i;const p=document.createElement("span");p.classList.add("description"),p.textContent=s,l.appendChild(c),l.appendChild(m),l.appendChild(p),n.appendChild(l),l.addEventListener("click",(function(){a.setAttribute("src",t),a.style.display="block",o.style.display="block",n.style.display="none",d.style.display="block"})),l.addEventListener("touchend",(function(){a.setAttribute("src",t),a.style.display="block",o.style.display="block",n.style.display="none",d.style.display="block"}))}))}},addImage=e=>{const{id:t,url:n,extension:i,previewURL:o}=e,r=function(){const e=new Uint32Array(3);return window.crypto.getRandomValues(e),(performance.now().toString(36)+Array.from(e).map((e=>e.toString(36))).join("")).replace(/\./g,"")}(),a=document.createElement("img");a.src=o,a.setAttribute("data-id",t),a.setAttribute("data-src",n),a.setAttribute("data-ext",i);const s=document.createElement("span");s.innerText=t;const l=document.createElement("button");l.setAttribute("data-item-id",r);const c=document.createElement("img");c.src="./images/cancel_close.svg",l.appendChild(c),l.addEventListener("click",(function(e){const t=e.currentTarget.getAttribute("data-item-id");removeImage(t)}));const m=document.createElement("div");m.classList.add("preview-item"),m.setAttribute("id",r),m.appendChild(a),m.appendChild(s),m.appendChild(l),d.appendChild(m),d.firstChild&&b.removeAttribute("disabled")},removeImage=e=>{const t=document.getElementById(e);t&&t.parentNode.removeChild(t),d.firstChild||b.setAttribute("disabled","true")};var u,_,y;return u=window,_="message",y=function(e){if("done"!==e.data&&e.origin===t)switch(e.data.msgType){case n:!async function handlAddImageMessage(e){const{url:t,extension:n}=e;if(a.includes(n))switch(g){case"s":if("svg"===n){showLoading();const e=getSVGFromURL(t);await e.then((function(e){i.svgCanvas.importSvgString(e),closeBrowser(),hideLoading()}),(function(e){hideLoading(),alert("Data URL conversion failed: ".concat(e))}))}else{showLoading();const e=imageToBase64(t);await e.then((function(e){importImage(e),closeBrowser(),hideLoading()}),(function(e){hideLoading(),alert("Data URL conversion failed: ".concat(e))}))}break;case"o":if("svg"!==n)break;if(closeBrowser(),!await i.openPrep())return;showLoading();const o=getSVGFromURL(t);await o.then((function(e){c.clear(),c.setSvgString(e),hideLoading()}),(function(e){hideLoading(),alert("Data URL conversion failed: ".concat(e))}));break;case"m":addImage(e)}else alert("Image type ".concat(n," not support."))}(e.data)}},u.addEventListener?u.addEventListener(_,y,!1):u.attachEvent&&u.attachEvent("on"+_,y),{svgicons:"ext-imagelib.xml",callback(){const e=document.createElement("template");e.innerHTML='<se-menu-item id="tool_imagelib" label="'.concat("imagelib:buttons.0.title",'" src="library.svg"></se-menu-item>'),insertAfter(s("tool_export"),e.content.cloneNode(!0)),s("tool_imagelib").addEventListener("click",(()=>{showBrowser()})),document.head.appendChild(o.content.cloneNode(!0))}}}},l=Object.freeze({__proto__:null,default:{select_lib:"Select an image library",show_list:"Back to show library list",import_single:"Import single",import_multi:"Import multiple",open:"Open as new document",buttons:[{title:"Image Library"}],imgLibs_0_name:"Library",imgLibs_0_description:"Free images library on this server",imgLibs_1_name:"Pixabay",imgLibs_1_description:"Free images library on pixabay"}}),c=Object.freeze({__proto__:null,default:{select_lib:"Select an image library",show_list:"Back to show library list",import_single:"Import single",import_multi:"Import multiple",open:"Open as new document",buttons:[{title:"Image Library"}],imgLibs_0_name:"Library",imgLibs_0_description:"Free images library on this server",imgLibs_1_name:"Pixabay",imgLibs_1_description:"Free images library on pixabay"}}),m=Object.freeze({__proto__:null,default:{select_lib:"Select an image library",show_list:"Back to show library list",import_single:"Import single",import_multi:"Import multiple",open:"Open as new document",buttons:[{title:"Image Library"}],imgLibs_0_name:"Library",imgLibs_0_description:"Free images library on this server",imgLibs_1_name:"Pixabay",imgLibs_1_description:"Free images library on pixabay"}}),p=Object.freeze({__proto__:null,default:{select_lib:"Select an image library",show_list:"Back to show library list",import_single:"Import single",import_multi:"Import multiple",open:"Open as new document",buttons:[{title:"Image Library"}],imgLibs_0_name:"Library",imgLibs_0_description:"Free images library on this server",imgLibs_1_name:"Pixabay",imgLibs_1_description:"Free images library on pixabay"}}),d=Object.freeze({__proto__:null,default:{select_lib:"Select an image library",show_list:"Back to show library list",import_single:"Import single",import_multi:"Import multiple",open:"Open as new document",buttons:[{title:"Image Library"}],imgLibs_0_name:"Library",imgLibs_0_description:"Free images library on this server",imgLibs_1_name:"Pixabay",imgLibs_1_description:"Free images library on pixabay"}}),b=Object.freeze({__proto__:null,default:{select_lib:"Select an image library",show_list:"Back to show library list",import_single:"Import single",import_multi:"Import multiple",open:"Open as new document",buttons:[{title:"Image Library"}],imgLibs_0_name:"Library",imgLibs_0_description:"Free images library on this server",imgLibs_1_name:"Pixabay",imgLibs_1_description:"Free images library on pixabay"}}),g=Object.freeze({__proto__:null,default:{select_lib:"Select an image library",show_list:"Back to show library list",import_single:"Import single",import_multi:"Import multiple",open:"Open as new document",buttons:[{title:"Image Library"}],imgLibs_0_name:"Library",imgLibs_0_description:"Free images library on this server",imgLibs_1_name:"Pixabay",imgLibs_1_description:"Free images library on pixabay"}}),u=Object.freeze({__proto__:null,default:{select_lib:"Select an image library",show_list:"Back to show library list",import_single:"Import single",import_multi:"Import multiple",open:"Open as new document",buttons:[{title:"Image Library"}],imgLibs_0_name:"Library",imgLibs_0_description:"Free images library on this server",imgLibs_1_name:"Pixabay",imgLibs_1_description:"Free images library on pixabay"}}),_=Object.freeze({__proto__:null,default:{select_lib:"Select an image library",show_list:"Back to show library list",import_single:"Import single",import_multi:"Import multiple",open:"Open as new document",buttons:[{title:"Image Library"}],imgLibs_0_name:"Library",imgLibs_0_description:"Free images library on this server",imgLibs_1_name:"Pixabay",imgLibs_1_description:"Free images library on pixabay"}});export{s as default};
